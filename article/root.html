<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<link rel="stylesheet" href="/_assets/main.css" />


    <title>ROOT - SUN的历史分享</title>
  <link rel="stylesheet" href="/_markdown_plugin_assets/katex/katex.css" />
<link rel="stylesheet" href="/_markdown_plugin_assets/highlight.js/atom-one-light.css" /></head>
  <body>
    <div class="main">
      <nav class="navigation">
        <a href="/">SUN的主页（点此返回首页）</a>
      </nav>
      <article>
        <header>
          <h1 class="article-title">ROOT</h1>
          <div class="article-info">
            <div>
              <span
                >Created At：<time datetime="1644477625254"
                  >2022-02-10 15:20</time
                ></span
              >
              <span
                >Updated At：<time datetime="1644500082282"
                  >2022-02-10 21:34</time
                ></span
              >
            </div>
            
          </div>
        </header>
        <div class="article-content markdown-body"><nav class="table-of-contents"><ul><li><a href="#root原理">ROOT原理</a><ul><li><a href="#0x00-关于root">0x00 关于root</a></li><li><a href="#0x01-setuid">0x01 setUID</a></li><li><a href="#0x02-linux-下的root">0x02 Linux 下的root</a></li><li><a href="#0x03-android-的root">0x03 Android 的root</a></li><li><a href="#0x04-android43-之后">0x04 Android4.3 之后</a></li></ul></li><li><a href="#新root思路">新ROOT思路</a><ul><li><a href="#工具">工具</a></li><li><a href="#操作方法">操作方法</a><ul><li><a href="#环境">环境</a></li><li><a href="#步骤">步骤</a><ul><li><a href="#温馨提示">温馨提示</a></li></ul></li></ul></li><li><a href="#驱动问题">驱动问题</a><ul><li><a href="#waiting-for-any-device安装手机驱动">waiting for any device（安装手机驱动）</a><ul><li><a href="#usb30接口不能读取bootloader模式下的手机">USB3.0接口（不能读取BootLoader模式下的手机）</a></li><li><a href="#手机没插好电脑读取不了">手机没插好，电脑读取不了</a></li><li><a href="#电脑没有安装驱动">电脑没有安装驱动</a></li></ul></li></ul></li></ul></li></ul></nav><p><strong>无ROOT情况下不影响正常使用，但是如果内存不够的话会不太方便使用</strong></p>
<ul>
<li>市面上大部分的ROOT软件都已经失效针对版本为2.2~4.1，没有人进行维持</li>
</ul>
<h1 id="root原理">ROOT原理</h1>
<h2 id="0x00-关于root"><strong>0x00 关于root</strong></h2>
<p>- linux和类Unix系统的最初设计都是针对多用户的操作系统，对于用户权限的管理很非常严格的，而root用户（超级用户）就是整个系统的唯一管理员，拥有等同于操作系统的所有权限。所以一旦获取到root权限，就可以对整个系统进行访问和修改。而在Android下获取root权限之后就可以自己定制系统，卸载一些预装软件，完全掌控自己的设备。</p>
<h2 id="0x01-setuid"><strong>0x01 setUID</strong></h2>
<ul>
<li>
<p>在讨论root的原理之前，有一个非常重要的概念，就是文件的setUID权限。linux下普通的文件权限大家都很清楚，可读，可写，可执行，下图很清楚的一个普通的可执行文件root的权限，r（可读），w（可写），x（可执行）。</p>
<p><img src="https://images2015.cnblogs.com/blog/624196/201606/624196-20160612193130886-1321292695.png" alt="img" /></p>
</li>
<li>
<p>但是，要考虑一种情况，比如说，一个用户是有权修改自己的密码的，但是记录密码的文件/etc/shadow只有root用户才是可写的，那普通用户如何才能修改自己的密码呢？这一切都要归功于setUID的设置，修改密码时使用的命令passwd对应的二进制程序是/usr/bin/passwd <img src="https://images2015.cnblogs.com/blog/624196/201606/624196-20160612194014105-616032278.png" alt="img" /></p>
</li>
<li>
<p>可以看到passwd的二进制文件的权限位中不仅仅是rwx了，多了一个s权限，而这个s权限就是我们的主角，<strong>setUID权限</strong>。</p>
</li>
<li>
<p>由于passwd有setUID权限，所以linux系统可以<strong>临时把这个文件的所有者（root）身份角色赋给普通用户</strong>，以达到让普通用户可以修改自己密码的目的。</p>
</li>
<li>
<p><strong>那如何设置setUID权限呢？</strong></p>
<ul>
<li>
<p>平常使用的普通文件权限位是由3、３、３共9位的二进制数字组成　－－－｜－－－｜－－－，分别对应文件所有者，文件所有者同一用户组权限和其他用户权限。最开始的名为root的可执行文件的权限为rwxrwxr-x，所对应的二进制位就是111 111 101 ，然后每三位对应421换算成16进制，就是775。而新增的setUID权限是在前面新增了三位，分别表示setGID、setUID、stick bit权限，而我们现在只关心setUID权限。因此加上setUID权限之后，文件的权限应该由4位数字组成，例如之前的root文件加上setUID权限就是4755。而修改密码的passwd文件对应的权限位就是4755。</p>
<p>-可以通过一个小例子来直观的感受一下，平常使用的cat命令对应的二进制文件是没有setUID权限的：</p>
</li>
</ul>
<p><img src="https://images2015.cnblogs.com/blog/624196/201606/624196-20160612201852011-1688576101.png" alt="img" /></p>
<ul>
<li>可以在普通用户下尝试使用cat去读取/etc/shadow文件的内容：</li>
</ul>
<p><img src="https://images2015.cnblogs.com/blog/624196/201606/624196-20160612202038730-533686501.png" alt="img" /></p>
<ul>
<li>提示权限不够，再给cat加上setUID权限之后再去读取/etc/shadow的内容：</li>
</ul>
<p><img src="https://images2015.cnblogs.com/blog/624196/201606/624196-20160612202346793-23202773.png" alt="img" /></p>
<ul>
<li>是可以读出来的，但是/etc/shadow中的内容都经过加密处理。</li>
</ul>
</li>
</ul>
<h2 id="0x02-linux-下的root"><strong>0x02 Linux 下的root</strong></h2>
<ul>
<li>平常使用的linux发行版，需要切换到root用户时，直接使用su命令，然后输入su用户的密码就可以切换到root用户了。<img src="https://images2015.cnblogs.com/blog/624196/201606/624196-20160609192815027-443851262.png" alt="img" /> <img src="https://images2015.cnblogs.com/blog/624196/201606/624196-20160612200929949-1567953583.png" alt="img" /></li>
</ul>
<h2 id="0x03-android-的root"><strong>0x03 Android 的root</strong></h2>
<ul>
<li>
<p>但是在未root的Android设备上是没有su的二进制文件，直接执行su命令会提示"su not found"。</p>
<p><img src="https://images2015.cnblogs.com/blog/624196/201606/624196-20160609200227761-318532671.png" alt="img" /></p>
</li>
<li>
<p>再进入已经root过的设备上查看，平常在adb shell中用的命令对应的二进制文件都是在/system/bin目录下，是存在su文件的：<img src="https://images2015.cnblogs.com/blog/624196/201606/624196-20160609195133699-2055442432.png" alt="img" /></p>
</li>
<li>
<p>可以看到这里的su只是一个指向/system/xbin/的一个链接。</p>
<p><img src="https://images2015.cnblogs.com/blog/624196/201606/624196-20160609194946074-419987031.png" alt="img" /></p>
</li>
<li>
<p>可以看到这里的<strong>su是有setUID权限位</strong>的。</p>
</li>
<li>
<p>而要在系统分区 /system/xbin 中添加文件本身就是需要root权限，而且设置su文件的所有者为root用户也是需要root权限的，设置setUID权限同样也需要root权限。</p>
</li>
<li>
<p>这就进入到了一个死循环当中，要利用su，首先要有root权限。因此这时就需要利用到Android存在的漏洞，Android系统本身存在着很多以root权限运行的原生进程，而这些root进程中如果存在可以利用的漏洞，就可以利用进程的root身份：</p>
<ol>
<li>拷贝su文件到/system/xbin系统分区；</li>
<li>设置su文件所有者为root用户；</li>
<li>设置su文件的setUID权限，便于自己的进程执行su命令获取root权限。</li>
</ol>
</li>
</ul>
<h2 id="0x04-android43-之后"><strong>0x04 Android4.3 之后</strong></h2>
<ul>
<li>以上方法在Android4.3之前可行，也就是Android还未引入SELinux的版本。从Android4.3开始引入SELinux之后，加上system分区多被挂载为nosuid，也就是SetUid位无效。所以都采用的是 C/S 结构来进行root。</li>
</ul>
<h1 id="新root思路">新ROOT思路</h1>
<h2 id="工具">工具</h2>
<ul>
<li>MiFlash2018-5-28-0 （<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"><mtext>补齐安卓驱动</mtext></mstyle></mrow><annotation encoding="application/x-tex">\textcolor{red}{补齐安卓驱动}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord cjk_fallback" style="color:red">补齐安卓驱动</span></span></span></span></span>）</li>
<li>adb-fastboot （<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"><mi>f</mi><mi>a</mi><mi>s</mi><mi>t</mi><mi>b</mi><mi>o</mi><mi>o</mi><mi>t</mi><mtext>软件命令工具</mtext></mstyle></mrow><annotation encoding="application/x-tex">\textcolor{red}{fastboot软件命令工具}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.10764em;color:red">f</span><span class="mord mathnormal" style="color:red">a</span><span class="mord mathnormal" style="color:red">s</span><span class="mord mathnormal" style="color:red">t</span><span class="mord mathnormal" style="color:red">b</span><span class="mord mathnormal" style="color:red">oo</span><span class="mord mathnormal" style="color:red">t</span><span class="mord cjk_fallback" style="color:red">软件命令工具</span></span></span></span></span>）</li>
<li>Magisk-v24.1-104033-o_1fqg9dm7las119kn7bu4r61ugj13-uid-238725 (<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"><mtext>面具</mtext><mi>R</mi><mi>O</mi><mi>O</mi><mi>T</mi><mtext>工具</mtext></mstyle></mrow><annotation encoding="application/x-tex">\textcolor{red}{面具 ROOT工具}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord cjk_fallback" style="color:red">面具</span><span class="mord mathnormal" style="margin-right:0.13889em;color:red">ROOT</span><span class="mord cjk_fallback" style="color:red">工具</span></span></span></span></span>)</li>
<li>X80 Plus (H5C6)-双系统-Android5.1-V1.06版固件 （<span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"><mtext>匹配对应的</mtext><mi>b</mi><mi>o</mi><mi>o</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>i</mi><mi>m</mi><mi>g</mi><mtext>文件进行刷入</mtext></mstyle></mrow><annotation encoding="application/x-tex">\textcolor{red}{匹配对应的boot.img文件进行刷入}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord cjk_fallback" style="color:red">匹配对应的</span><span class="mord mathnormal" style="color:red">b</span><span class="mord mathnormal" style="color:red">oo</span><span class="mord mathnormal" style="color:red">t</span><span class="mord" style="color:red">.</span><span class="mord mathnormal" style="color:red">im</span><span class="mord mathnormal" style="margin-right:0.03588em;color:red">g</span><span class="mord cjk_fallback" style="color:red">文件进行刷入</span></span></span></span></span>）</li>
</ul>
<h2 id="操作方法">操作方法</h2>
<p>目前安卓12、11、10、9、8、7通用。操作前建议备份数据！</p>
<p><strong>FastBoot</strong>刷<strong>Magisk</strong>的优点</p>
<p>1、无需第三方<strong>Recovery</strong>
2、不影响系统升级（完整包升级）</p>
<p></p>
<h3 id="环境">环境</h3>
<p>1、BootLoader已解锁（<strong>必须解锁</strong>，小米手机参考：<a title="https://magiskcn.com/unlock-mi" href="https://magiskcn.com/unlock-mi">magiskcn.com/unlock-mi</a>）</p>
<p>2、小米10Pro12+512</p>
<p>3、MIUI12.5开发版21.5.20（安卓11）(支持稳定版，解锁BL一样可刷)</p>
<p>4、Windows电脑一台</p>
<p></p>
<h3 id="步骤">步骤</h3>
<ol>
<li>、系统是纯净官方系统（如果不是，建议刷一次完整包）</li>
<li>、手机下载安装：<a title="https://www.coolapk.com/apk/bin.mt.plus" href="https://www.coolapk.com/apk/bin.mt.plus">MT管理器</a></li>
<li>、手机下载安装：<a title="https://magiskcn.com/magisk-download" href="https://magiskcn.com/magisk-download">Magisk</a></li>
<li>、下载系统完整包：<a title="https://magiskcn.com/get-miui" href="https://magiskcn.com/get-miui">magiskcn.com/get-miui</a>（其他品牌请自行到官网下载）</li>
<li>、打开<strong>MT管理器</strong>，找到我们下载好的系统包，点开zip包，长按<strong>boot.img</strong> 提取出来到 <strong>Dowmload</strong> 目录</li>
</ol>
<p>（小米手机系统包默认下载的位置：<strong>Download/dowmloaded_rom</strong>）</p>
<p>（如果系统包里面没有<strong>boot.img</strong>，只有<strong>payload.bin</strong>，请参考这个教程提取：<a title="https://magiskcn.com/payload-boot" href="https://magiskcn.com/payload-boot">magiskcn.com/payload-boot</a>）</p>
<p><img src="https://magiskcn.com/wp-content/uploads/2021/11/eafbece1016a6af-5.jpg" alt="Magisk安装教程插图" title="Magisk安装教程插图" />
、打开Magisk【安装 – 选择并修补一个文件 –
弹窗文件管理窗口（找到刚刚提取的<strong>boot.img</strong>）- 开始】</p>
<p><img src="https://magiskcn.com/wp-content/uploads/2021/11/eafbece1016a6af-3.jpg" alt="Magisk安装教程插图1" title="Magisk安装教程插图1" /></p>
<ol start="7">
<li>修补结束，会生成一个名字为（<strong>magisk_patched-版本号_随机字符.img</strong>）的文件（每次生成的随机字符都不一样，使用的时候请输入生成的名字）</li>
</ol>
<p><img src="https://magiskcn.com/wp-content/uploads/2021/05/482d94bf4294a56.png" alt="Magisk安装教程插图2" title="Magisk安装教程插图2" /></p>
<ol start="8">
<li>
<p>手机连接到电脑，把<strong>boot.img</strong>和（<strong>magisk_patched-2X000_xxxxx.img</strong>）两个文件复制到电脑</p>
</li>
<li>
<p>下载FastBoot：<a title="https://mrzzoxo.lanzouw.com/iMbPYz63p6f" href="https://mrzzoxo.lanzouw.com/iMbPYz63p6f">https://mrzzoxo.lanzouw.com/iMbPYz63p6f</a><br />
（解压出来，把<strong>magisk_patched-2X000_xxxxx.img</strong>复制到fastboot目录里）</p>
</li>
</ol>
<p><img src="https://magiskcn.com/wp-content/uploads/2021/07/e86b4113940c8c2-1.png" alt="Magisk安装教程插图3" title="Magisk安装教程插图3" /></p>
<ol start="10">
<li>
<p>打开bat文件（<strong>打开CMD命令行.bat</strong>）把手机重启到BootLoader模式（<strong>重启+音量-键</strong>）然后输入下面的命令</p>
<p><code>fastboot flash boot 面具文件</code></p>
</li>
</ol>
<p><img src="https://magiskcn.com/wp-content/uploads/2021/11/eafbece1016a6af-4.png" alt="Magisk安装教程插图4" title="Magisk安装教程插图4" /></p>
<p>11、出现下面这三行代码，就是成功刷入了。</p>
<div><pre class="hljs"><code>        Sending ‘boot’ (<span class="hljs-number">131072</span> KB) OKAY [ <span class="hljs-number">3</span>.<span class="hljs-number">123</span>s] 
        Writing ‘boot’ OKAY [ <span class="hljs-number">0</span>.<span class="hljs-number">397</span>s] 
        Finished. Total <span class="hljs-built_in">time</span>: <span class="hljs-number">4</span>.<span class="hljs-number">645</span>s</code></pre></div>
<ol start="12">
<li>重启手机（开机有震动基本没问题了）耐心等手机开机。（显示Magisk的版本，就是刷好了的）</li>
</ol>
<p><img src="https://magiskcn.com/wp-content/uploads/2021/11/eafbece1016a6af-4.jpg" alt="Magisk安装教程插图5" title="Magisk安装教程插图5" /></p>
<p>(A/B）(Ramdisk）(SAR）
这是手机分区，老款手机会显示"否"。新出的手机一般都显示"是"。不影响使用。</p>
<hr />
<h4 id="温馨提示">温馨提示</h4>
<p>如果刷模块不兼容或者其他骚操作导致卡米的话，可以把我们前面提取的boot.img通过fastboot刷回去，恢复原系统，一般都能正常开机！<br />
boot.img保留一份在电脑，避免出问题了可以自救下！还原boot指令</p>
<pre><code>`fastboot flash boot boot.img`
</code></pre>
<p>后期系统更新，直接下载全量完整包升级，然后重复上面的步骤就可以继续愉快的使用Magisk了！</p>
<p>如果你手机是AB分区还可以：<a title="/ab-magisk-update" href="/ab-magisk-update">AB分区保留面具升级系统</a></p>
<h2 id="驱动问题">驱动问题</h2>
<h3 id="waiting-for-any-device安装手机驱动">waiting for any device（安装手机驱动）</h3>
<p><img src="https://magiskcn.com/wp-content/uploads/2021/11/eafbece1016a6af.png" alt="waiting for any device（安装手机驱动）插图" /></p>
<p>waiting for any device 翻译意思：等待任何设备</p>
<hr />
<p>有以下几种情况：</p>
<h4 id="usb30接口不能读取bootloader模式下的手机"><strong>USB3.0接口</strong>（不能读取BootLoader模式下的手机）</h4>
<p>解决办法：换个USB2.0口，如果全不行就换台式机</p>
<h4 id="手机没插好电脑读取不了"><strong>手机没插好，电脑读取不了</strong></h4>
<p>解决办法：重新插拔，换个USB接口，换条数据线</p>
<h4 id="电脑没有安装驱动"><strong>电脑没有安装驱动</strong></h4>
<ul>
<li>解决办法：</li>
</ul>
<p>1.电脑下载 <a title="http://bigota.d.miui.com/tools/MiFlash2018-5-28-0.zip" href="http://bigota.d.miui.com/tools/MiFlash2018-5-28-0.zip">小米线刷工具2018</a></p>
<p>2.解压出来，打开XiaoMiFlash.exe，Driver – 安装</p>
<p><img src="https://magiskcn.com/wp-content/uploads/2021/11/eafbece1016a6af-1.png" alt="waiting for any device（安装手机驱动）插图1" /></p>
</div>
      </article>
    </div>
  </body>
</html>
